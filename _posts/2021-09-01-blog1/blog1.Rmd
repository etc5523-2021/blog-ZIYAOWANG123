---
title: "Blog-1"
description:
  Entry 1 - The update of COVID-19 in the United States.
author:
  - name: ZIYAO WANG (Billy)
date: "`r Sys.Date()`"
output:
  distill::distill_article:
    toc: true
    toc_float: true
    self_contained: false
---

# 2. why I don't have blog1.html in my docs/post folder?
# 3. the html code in Welcome rmd will not run in index html, why?
# 4. the images URL don't work?
# 5. one of the data set, the group_by does not work

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = F, message = F)
```

```{r loadpackages, eval=TRUE}
library(tidyverse)
library(DT)
library(kableExtra)
library(lubridate)
library(plotly)
library(sparkline)
```

## Target Country - United Stated
 - Brief Introduction: 

### Data Description

This blog has used two main data sets as the base for the construction of data communication regarding COVID-19 information.

#### Data Source 1 - R Package `nCov2019`

The data set is collected from various sources for different relevant information.  
 - Latest data of corona virus cases from [worldometers](https://www.worldometers.info/coronavirus/)  
 - Historical data of corona virus cases from [JHUCSSE](https://coronavirus.jhu.edu/map.html)  
 - Vaccine data from [raps.org](https://www.raps.org/news-and-articles/news-articles/2020/3/covid-19-vaccine-tracker)  
 - Therapeutics data from [raps.org](https://www.raps.org/news-and-articles/news-articles/2020/3/covid-19-therapeutics-tracker)  

This data source contains two core parts. First one is the GUI explorer section which has a function of `dashboard` to use a simple and interactive dashboard for information communication. Second part is the CLI analysis which includes a work flow from data query to data operation and lastly the visulization output of both geographic and animation plots. 

This blog will __*focus on the CLI analysis part*__, which will query the update COVID-19 data from five different aspects. It will include the "latest update COVID-19 info.", "global COVID-19 info.", "historical COVID-19 info.", "vaccine details", "therapeutics status and progress". 

<center>**Here is the variable descriptions for this data source**</center>

```{r variablenames, eval=TRUE}
variable <- data.frame(
  'variable_names' = c(
    "active number",
    "activePerOneMillion",
    "cases",
    "casesPerOneMillion",
    "continent",
    "country",
    "critical",
    "criticalPerOneMillion",
    "date",
    "deaths",
    "deathsPerOneMillion",
    "oneCasePerPeople",
    "oneDeathPerPeople",
    "oneTestPerPeople",
    "population",
    "recovered",
    "recoveredPerOneMillion",
    "tests",
    "testsPerOneMillion",
    "todayCases",
    "todayDeaths",
    "todayRecovered",
    "updated"
  ),
  'description' = c(
    "confirmed cases - deaths - recovered",
    "active number / million population",
    "confirmed cases",
    "confirmed cases / million population",
    "continent",
    "country",
    "Critical patients",
    "Critical patients / million population",
    "date",
    "deaths",
    "deaths patients / million population",
    "one Case Per People",
    "one Death Per People",
    "one Test Per People",
    "population",
    "recovered",
    "recovered Per One Million",
    "COVID-19 test",
    "COVID-19 test / million population",
    "confirmed cases in today",
    "confirmed death cases in today",
    "confirmed recovered cases in today",
    "the latest update time"
  )
)

```

```{r variable-table, eval=TRUE}
variable %>% 
  kable(caption = "Variable Summary for Data Source 1") %>% 
  kable_classic(full_width = F, html_font = "Cambria") %>% 
  kable_styling(bootstrap_options = c("striped","hover", "condensed"),
                position = "center",
                font_size = 10) %>% 
  row_spec(0, bold = T, color = "#4199C4", background = "#A7F5D0") %>% 
  row_spec(0:23, align = "c") %>% 
  column_spec(1:2, border_right = T, border_left = T) %>% 
  scroll_box(height = "200px")
```



#### Data Source 2 - [New York Times Covid-19 data sets](https://github.com/nytimes/covid-19-data)

This data source is collected by the journalists from the New York Times across several time zones to monitor news conferences and public data releases with seeking clarification from official bodies. It is under the license of [CC BY-NC](https://creativecommons.org/licenses/by-nc/4.0/legalcode) which allows the users to adapt the data with proper attribution given.  

> Contact Information: covid-data@nytimes.com

<center>**Here is the variable descriptions for this data source**</center>

```{r variablenames2, eval=TRUE}
variable2 <- data.frame(
  "variable_name" = c(
    "date",
    "state",
    "fips",
    "cases",
    "deaths"
  ),
  types = c(
    "character",
    "character",
    "integer",
    "integer",
    "integer"
  ),
  description = c(
    "date of record",
    "state name (in US)",
    "Federal Information Processing Standards (unique code for each state/counties)",
    "confirmed cases (accumulated)",
    "confirmed deaths (accumulated)"
  )
)

variable2 %>% 
  kable(caption = "Variable Summary for Data Source 2") %>% 
  kable_classic(full_width = F, html_font = "Cambria") %>% 
  kable_styling(bootstrap_options = c("striped","hover", "condensed"),
                full_width = F,
                position = "center",
                font_size = 10) %>% 
  row_spec(0, bold = T, color = "#4199C4", background = "#A7F5D0", font_size = 12) %>% 
  row_spec(0:5, align = "c") %>% 
  column_spec(1:3, border_right = T, border_left = T)
```




```{r loaddata}
# remotes::install_github("yulab-smu/nCov2019", dependencies = TRUE, force = TRUE)
library(nCov2019)
res <- query()
```

```{r readdata}
names(res)
x <- res$latest
y <- res$historical

```


```{r data1}
df_brief <- x["Global"]
df_detail <- (x$detail)
us_his <- y["USA"]

```

**The update COVID-19 information for top 50 countries by total confirmed cases (at 01/09/2021)**


```{r table1}
top50 <- df_brief %>% 
  arrange(desc(cases)) %>% 
  slice_head(n=50) %>% 
  select(-updated, -(cases:recovered))

table1 <- top50 %>% 
  arrange(desc(todayCases))

datatable(table1, 
           escape = FALSE,
           caption = "COVID-19 updates for Top 50 countries (by total confirmed cases)",
            colnames = c("Country","Total Active cases",
                         "Update confirmed cases", "Update deaths", 
                         "Update recovered", "Total population", "Total COVID-19 tested"),
            options = list(pageLength = 10))

```

**Monthly COVID-19 updates for USA**
```{r table2-sparkline}
table2 <- us_his %>% 
  mutate(year = year(date),
         month = month(date),
        new_cases = cases - lag(cases),
        new_deaths = deaths - lag(deaths),
        daily_recovered = recovered - lag(recovered)
        ) %>% 
  group_by(year,month) %>% 
  summarise(new_cases = spk_chr(new_cases,
                                type = "line"),
            new_deaths = spk_chr(new_deaths,
                                 type = "line"),
            daily_recovered = spk_chr(daily_recovered,
                                 type = "line")
            ) 

 datatable(table2, 
           escape = FALSE,
           caption = "Monthly variations in confirmed, deaths, and recovered cases in USA",
            colnames = c("Year","Month", "New Cases", "New Deaths", "Daily recovery"),
            options = list(fnDrawCallback = 
            htmlwidgets::JS('function(){HTMLWidgets.staticRender();}'))) %>% 
    spk_add_deps()
```

**2021/09 monthly COVID-19 updates for each states in USA**

```{r data2}
state_data <- read.csv(here::here("data/us-states.csv"))
update_state <- state_data %>% 
  mutate(year = year(date),
         month = month(date),
         states = state,
         'cases(accumulated)' = cases,
         'deaths(accumulated)' = deaths) %>% 
  select(year:`deaths(accumulated)`) %>% 
  filter(year == "2021") %>% 
  filter(month == 9)

```

```{r table3}
table3 <- update_state %>% 
  arrange(desc(`cases(accumulated)`)) %>% 
  datatable( 
           escape = FALSE,
           caption = "Semi-annual monthly variations in confirmed, deaths, and recovered cases in USA",
            colnames = c("Year","Month", "states", "Total confirmed cases", "Total deaths"),
            options = list(pageLength = 10))
table3

```

Construct a line chart to observe the top 5 states with greatest total confirmed cases movement from 2020 to 2021. 

```{r figure1}
top5_state <- state_data %>% 
  filter(state %in% c("California",
                      "Texas",
                      "Florida",
                      "New York",
                      "Illinois"
                      )) %>% 
  select(-fips) %>% 
  mutate(date = ymd(date))


figure1 <- top5_state %>% 
  arrange(desc(cases)) %>% 
  ggplot(aes(x = date, y = cases, color = state))+
  geom_line()+
  theme_bw()
ggplotly()
```

```{r}
state_data %>% 
  group_by(state)
```





